---
- name: Install Go
  sudo: yes
  apt: pkg=gccgo-4.8-multilib-powerpc-linux-gnu state=present

- name: Untar Go
  shell: "tar -xzvf go{{go_version}}.linux-amd64.tar.gz"
  args: {chdir: "/opt", creates: "/opt/go"}
  sudo: yes

- name: Creates GOPATH
  file: "path=/home/{{username}}/go state=directory"
  sudo: no

- file: src=/opt/go/bin/go dest=/usr/bin/go state=link
  sudo: yes

- name: See if environment are set
  command: "grep GOROOT /home/{{username}}/.bashrc"
  register: goroot_variable_from_env
  ignore_errors: True

- name: Set environment variables
  shell: "echo '{{item}}' >> /home/{{username}}/.bashrc"
  with_items:
    - "export GOROOT=/opt/go"
    - "export GOPATH=/home/{{username}}/go"
    - "export PATH=$GOROOT/bin:$GOPATH/bin:$GOPATH/src/github.com/cloudfoundry/bosh-init/out:$PATH"
  when: (goroot_variable_from_env.stdout == "")
